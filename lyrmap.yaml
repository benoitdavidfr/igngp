title: carte Leaflet affichant une couche ftsmap
$schema:
  $id: https://igngp.geoapi.fr/lyrmap.yaml#/$schema
  definitions:
    
    jsonType:
      description: type JSON
      oneOf:
        - type: string
        - type: number 
        - type: boolean
        - description: objet JSON
          type: object
          additionalProperties: false
          patternProperties:
            ^[-a-zA-Z0-9_+$]+$:
              description: valeur
              $ref: '#/definitions/jsonType'
    layer:
      description: description d'une couche
      type: object
      additionalProperties: false
      properties:
        title:
          description: nom de la couche dans la carte
          type: string
        type:
          description: type de couche
          type: string
          enum:
            - L.TileLayer
            - L.GeoJSON.AJAX
            - L.UGeoJSONLayer
        params:
          description: paramètres d'initialisation de la couche sous la forme d'une liste
          type: array
          items:
            $ref: '#/definitions/jsonType'
    lyrDict:
      description: dictionnaire de couches indexées par leur nom
      type: object
      additionalProperties: false
      patternProperties:
        ^[-a-zA-Z0-9 _+<>?;$]+$:
          description: définition de la couche
          $ref: '#/definitions/layer'
  type: object
  additionalProperties: false
  properties:
    title:
      description: titre du document
      type: string
    $schema:
      $ref: http://json-schema.org/schema#
    head:
      type: object
      additionalProperties: false
      properties:
        title:
          description: titre de la carte
          type: string
        plugIns:
          description: code JS d'inclusion des plugIns
          type: string
    body:
      type: object
      additionalProperties: false
      properties:
        jsFunctions:
          description: code JS des fonctions utiles
          type: string
        view:
          description: définition de la zone d'affichage initiale
          type: object
          additionalProperties: false
          properties:
            latLon:
              description: couple latitude, longitude du centre
              type: array
              maxItems: 2
              minItems: 2
              items:
                type: number
            zoom:
              description: niveau de zoom
              type: integer
        plugInActivation:
          description: code JS dactivation des plug-ins
          type: string
        baseLayers:
          description: dict. des couches de base indexées par leur nom
          $ref: '#/definitions/lyrDict'
        defaultBaseLayer:
          description: clé de la couche utilisée par défaut
        overlays:
          description: dict. des couches superposables indexées par leur nom
          $ref: '#/definitions/lyrDict'

head:
  title: "<?php echo $title;?>"
  plugIns: |
    <!-- Include the edgebuffer plugin -->
    <script src="https://geoapi.fr/shomgt/leaflet/leaflet.edgebuffer.js"></script>
    <!-- Include the Control.Coordinates plugin -->
    <link rel='stylesheet' href='https://geoapi.fr/shomgt/leaflet/Control.Coordinates.css'>
    <script src='https://geoapi.fr/shomgt/leaflet/Control.Coordinates.js'></script>
    <!-- Include the uGeoJSON plugin -->
    <script src="https://geoapi.fr/shomgt/leaflet/leaflet.uGeoJSON.js"></script>
    <!-- plug-in d'appel des GeoJSON en AJAX -->
    <script src='https://geoapi.fr/shomgt/leaflet/leaflet-ajax.js'></script>
body:
  jsFunctions: |
    // affichage des caractéristiques de chaque feature
    var onEachFeature = function (feature, layer) {
      var popupContent = '<pre><u><i>id</i></u>: '+feature.id+"\\n";
      popupContent += '<u><i>'+'properties</i></u>: '+JSON.stringify(feature.properties)+"\\n";
      popupContent += '</ul>';
      layer.bindPopup(popupContent);
      layer.bindTooltip(feature.id);
    }
  view:
    latLon: [46.5,3]
    zoom: 6
  plugInActivation: |
    // activation du plug-in Control.Coordinates
    var c = new L.Control.Coordinates();
    c.addTo(map);
    map.on('click', function(e) { c.setCoordinates(e); });
  baseLayers:
    Plan IGN:
      type: L.TileLayer
      params:
        - 'https://igngp.geoapi.fr/tile.php/plan-ignv2/{z}/{x}/{y}.png'
        - format: image/png
          minZoom: 0
          maxZoom: 18
          detectRetina: false
          attribution: "&copy; <a href='http://www.ign.fr' target='_blank'>IGN</a>"
    OSM:
      type: L.TileLayer
      params:
        - 'http://{s}.tile.osm.org/{z}/{x}/{y}.png'
        - attribution: "&copy; <a href='https://www.openstreetmap.org/copyright' target='_blank'>les contributeurs d’OpenStreetMap</a>"
    Fond blanc:
      type: L.TileLayer
      params:
        - 'https://visu.gexplor.fr/utilityserver.php/whiteimg/{z}/{x}/{y}.jpg'
        - format: 'image/jpeg'
          minZoom: 0
          maxZoom: 21
          detectRetina: false
  defaultBaseLayer: Plan IGN
  overlays:
    "<?php echo $collId;?>":
      type: L.GeoJSON.AJAX
      params:
        - '<?php echo $collUrl;?>'
        - {style: { color: 'blue'}, minZoom: 0, maxZoom: 18, onEachFeature: {$function: onEachFeature}}
    UGeoJSONLayer:
      type: L.UGeoJSONLayer
      params:
        - endpoint: '<?php echo $collUrl0;?>'
          minZoom: 0
          maxZoom: 18
          usebbox: true
          onEachFeature: {$function: onEachFeature}
    debug:
      type: L.TileLayer
      params:
        - 'http://visu.gexplor.fr/utilityserver.php/debug/{z}/{x}/{y}.png'
        - {"format":"image/png","minZoom":0,"maxZoom":21,"detectRetina":false}
